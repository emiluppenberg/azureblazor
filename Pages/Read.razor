@inject HttpClient httpClient;
@inject IConfiguration Configuration

@page "/read"

<div class="container mt-4">
  <h3 class="mb-3">Students</h3>

  @if (Students is null)
  {
    <div class="text-muted">Loading…</div>
  }
  else if (!Students.Any())
  {
    <div class="text-muted">No students found.</div>
  }
  else
  {
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>Id</th>
          <th>Name</th>
          <th>Age</th>
          <th>Course</th>
        </tr>
      </thead>
      <tbody>
        @foreach (var student in Students)
        {
          <tr>
            <td>@student.Id</td>
            <td>@student.Name</td>
            <td>@student.Age</td>
            <td>@student.Course?.Name</td>
          </tr>
        }
      </tbody>
    </table>
  }
</div>

@code {
  public List<StudentDTO>? Students { get; set; }

  protected override async Task OnInitializedAsync()
  {
    var response = await httpClient.GetAsync($"{Configuration["ApiBaseUrl"]}/students");
    response.EnsureSuccessStatusCode();

    Students = await response.Content.ReadFromJsonAsync<List<StudentDTO>>();
  }
}